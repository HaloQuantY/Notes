## Git学习笔记



### 什么是Git

> Git is a [free and open source](https://git-scm.com/about/free-and-open-source) distributed version control system designed to handle everything from small to very large projects with speed and efficiency.

GIt是一个免费且开源的<strong>分布式版本控制系统</strong>，用于迅速高效地处理各种规模项目。

#### 版本控制系统

​	是一种记录一个或多个文件内容变化，以便将来查阅特定版本修订情况的系统。使用版本控制系统可以将历史版本进行备份，随时将项目回复到原先状态。

​	同时也可以比较文件版本之间差异，定位问题的产生处。

#### 分布式和集中式

##### 集中式版本控制系统

​	集中式版本控制系统以SVN为主，是过去版本控制主流。

​	集中式版本控制系统中，由一个单一服务器保存项目各版本，各开发人员通过客户端连接到服务器取出最新文件和提交更新。

​	优点：各开发人员可以看到项目的变更，管理员易于分配各开发者权限，易于维护数据库。

​	缺点：中央服务器故障后果十分严重，在故障期间开发人员编写的代码没有历史记录。

##### 分布式版本控制系统

​	以Git为主，是现在版本控制系统主流。

​	分布式控制系统中，客户端并不只提取最新版本文件快照，而是将代码仓库完整地镜像下来。即每个客户端都是一个服务器。

​	优点：

- 任何一个服务器发生故障时，都可以用任何一个镜像本地仓库进行恢复。
- 可以利用远端代码仓库实现同一项目不同团队协作。
- 断网情况下仍然可以开发，使用github团队协作时就算github故障，每个客户端也保存完整项目（版本控制由本地进行）。
- Git保存项目的完整快照而非版本间差异，占用本地存储容量略大，但版本回滚时性能高。

#### Git的两大重要概念

区域：

- 工作区
- 暂存区
- 版本库

工作区位于项目根目录，Git不会对工作区内文件进行操作。暂存区则是用于缓存修改后的文件，目的是累积一定的修改之后再将文件全部推送到版本库中成为新版本。

对象：

- Git对象
- 树对象
- 提交对象



### Git命令

- 本地库初始化
- 基本操作
- 分支管理

![basic commad](https://www.runoob.com/wp-content/uploads/2015/02/git-command.jpg)

#### Linux基础命令

- clear：清除屏幕
- echo ”test text“：向控制台中输出信息
- ll：将当前目录下子文件和子目录平铺再控制台
- find 目录名：对应目录名下子孙平铺在控制台
- find 目录名 -type f：对应目录名下子文件平铺在控制台
- rm 文件名：删除文件
- mv 源文件 重命名文件：重命名
- cat 文件url：查看对应文件内容

#### 本地库和远程库的交互

- push，将本地库内容推送到远程库上
- clone，将远程库内容拷贝到本地并初始本地库
- pull，将远程库的修改拉取到本地
- fork，团队外的协作，将远程库复制为令一个内容相同的远程库
- pull request，团队外协作，fork了一个远程库之后，向原库拥有者发起修改申请，得到拥有者审核同意之后可以进行合并（merge）操作
- merge，将团队外对远程库的修改进行合并

#### 本地库初始化

- $ git init：在当前文件夹创建一个git目录，存放本地库相关子目录文件

- $ git config user.name "username" 设置项目级别用户名，带--global修饰符为操作系统级别用户名

- $ git config user.email email@email.com 设置项目级别邮箱，带--global修饰符为操作系统级别用户名

  注意：此处的签名（用户名和邮箱）与登录远端仓库所用的用户名不同

  ​			签名信息保存到git目录下的config文件夹

#### 添加提交文件，查看状态操作

##### 查看状态

- $ git status：查看状态

  在此命令中可看到工作区，暂存区和提交状态

##### 添加文件

- $ git add `文件名`：添加文件到暂存区，也即是将文件利用git进行追踪
- $ git rm --cached `文件名`：将文件移除暂存区，即撤回之前修改

##### 提交文件

- $ git commit `文件名` -m "提交说明"：将暂存区文件提交到仓库，提交说明必写

  第一次以后的提交可以跳过add添加缓存区直接提交文件

#### 版本穿梭

##### 查看版本历史

- $ git log：查看当前项目的版本历史信息

  主要信息有是多条修改记录，在修改记录中保存了提交的哈希值，HEAD指针（指向当前版本），分支以及提交作者，时间，提交注释等

- $ git log --pretty=oneline：简洁显示历史信息，仅显示提交哈希值和提交注释

- $ git log --oneline：简洁显示历史信息，仅显示部分提交哈希值和提交注释

- $ git reflog：显示穿梭版本时的回滚步骤

##### 前进/后退历史版本

​	HEAD指针：指向当前版本，通过移动HEAD指针能够达到版本穿梭的效果

- $ git reset --hard `提交哈希值`：使用索引值进行版本穿梭，此处使用reflog命令中的部分索引值即可

- $ git reset --hard HEAD^：将版本向后退一步，多个^可回退多步

- $ git reset --hard HEAD~2：将版本后退两步，后面数字为几就后退几步

  reset命令中的修饰符--hard可选--soft和--mixed，

​	--soft：在本地库中移动HEAD指针，不修改缓存区和工作区

​	--mixed：在本地库移动HEAD指针，重置缓存区

​	--hard：在本地库移动HEAD指针，重置缓存区和工作区

#### 删除文件

##### 永久删除文件后找回

​	在git中记录的是项目的修改，因此就算是永久删除文件（$ git rm file）也算作一种修改并记录到库中。因此要找回永久删除的文件直接回退到前一个版本即可

- $ git reset --hard HEAD^

##### 添加到缓存区的删除文件找回

​	这种情况是工作区删除了文件并添加了此删除修改，但还没有提交到库中。此时可以利用回退到最新版本重置缓存区和工作区。

- $ git reset --hard HEAD (该方法可以撤销所有提交到缓存区的修改，因为强制同步最新版本项目)

#### 比较文件差异

- $ git diff `文件名`：比较文件在工作区和缓存区中的区别
- $ git diff `提交哈希值` `文件名`：比较文件在工作区中和对应版本的区别



### 分支管理

#### 什么是分支

​	在版本控制过程中，使用多条线同时推进多个任务，这种操作称为分支。

​	分支创建：在项目中，一个分支就是项目的一条时间线。初始仅有一个主分支master，每次提交版本时master分支会延长。在新建分支时，git会创建对应的分支指针（如分支名为dev的指针）指向master当前的版本，然后将HEAD指针指向dev指针（HEAD指针实际上指向当前分支）就完成了分支的切换。

​	分支延长：在新分支dev中，修改文件并提交后，dev分支延长而master分支则不变。

​	分支合并：在合并时，直接将master指针指向dev最新版本，则分支合并完成。

#### 分支优点

- 并行推进多个功能开发，提高开发效率
- 提高开发容错率，如果分支开发失败将失败分支删除重新开发即可

#### 分支操作

- $ git branch `分支名`：创建分支

- $ git branch -v：查看分支

- $ git checkout `分支名`：切换分支

- $ git merge `另一个分支名`：将当前分支和另一个分支进行合并

  注意：此处需要先切换到接收合并的分支，另一个分支是有新内容的分支

- $ git branch -d  `分支名`：删除分支

#### 分支冲突

​	分支冲突指合并的两个分支都有新内容，且新内容位于相同文件的相同部位，则合并分支时会提示分支冲突，需要手动合并。

##### 冲突表现

​	分支冲突产生时，会在当前分支的文件中提示冲突文本。

##### 解决冲突

- 将文件中的特殊符号删除，然后直接在文件修改至满意后保存。
- 利用 git add 将文件提交表示已经解决冲突，但此时仍然在合并状态。
- git commit 命令将文件提交到本地库，结束合并状态。注意此处不能够带文件名



### Git基本原理

#### 哈希

​	哈希是一种加密算法，将明文通过哈希算法变为密文。

##### 哈希算法特点

- 不论输入数据量有多大，得到加密结果都是长度固定的值
- 在哈希算法确定，输入数据确定时，可以保证输出的数据能够不变
- 哈希算法确定，输入数据不定时，得到的结果一定不同
- 哈希算法不可逆

##### Git中哈希算法的应用

​	用于验证数据完整性，在服务器端和客户端得到的数据都经过哈希加密后比较密文即可验证文件是否损坏。

#### Git保存版本的机制

##### Git文件管理机制

​	Git将数据看作小型文件系统一组快照。每次都将全部文件制作一个快照并且保存快照的索引。如果一个其中一些文件在版本更新时没有改变，则不会重新存储相同文件，而是建立一个指针指向之前存储的文件。

##### Git提交对象和树对象

​	每次提交修改时，都会创建一个对应的Git提交对象，该对象拥有自己的哈希值，同时此对象中包含一系列描述此次修改的数据，其中就有树对象。

​	树对象是将一次修改中的所有文件进行哈希得到的哈希值列表，可以由此判断改变的文件。

​	每次修改得到的Git提交对象会指向上一个Git提交对象，由此构成一个版本链。

#### Git分支管理机制

​	Git的分支管理实际上时创建和移动指针。

##### 分支创建和切换分支

​	分支在实际上就是一个指向Git提交对象的指针，而HEAD指针指向当前分支指针。

​	新建分支时，创建了一个新的分支指针指向当前版本。而切换到新建分支时将HEAD指向了新建的分支指针。

​	











​	