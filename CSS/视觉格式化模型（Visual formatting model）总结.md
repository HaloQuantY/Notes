## 视觉格式化模型（Visual formatting model）总结

参考：MDN文档https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Visual_formatting_model

​			W3C文档https://www.w3.org/TR/2011/REC-CSS2-20110607/visuren.html#q9.0



### 什么是视觉格式化模型

> how user agents process the [document tree](https://www.w3.org/TR/2011/REC-CSS2-20110607/conform.html#doctree) for visual [media](https://www.w3.org/TR/2011/REC-CSS2-20110607/media.html).（W3C）

> 视觉格式化模型是处理和在视觉媒体上显示文档时使用的计算规则。（MDN）

由元素到盒子，由盒子到布局。视觉格式化模型包含两个主要内容，分别是控制盒子生成和定位方案。



每个文档树中的元素都会根据盒模型产生0或多个盒子，而盒子的布局由以下原因：

- 盒子维度和类型
- 定位方案position scheme（普通流定位，浮动定位，绝对定位）
- 同文档树中其他元素的关系
- 外部信息



基本术语：

- **块**：block，一个抽象的概念，一个块在文档流上占据一个独立的区域，块与块之间在垂直方向上按照顺序依次堆叠。
- **包含块**：containing block，包含其他盒子的块称为包含块。盒子的位置和尺寸由包含块的边界计算而来，但不总是位于包含块中，有可能溢出。生成的盒子也会创建一个包含后代元素的包含块，但说到一个盒子的包含块时，指的是包含他自身的包含块而非他创建的包含块。
- **盒子**：box，一个抽象的概念，由CSS引擎根据文档中的内容所创建，主要用于文档元素的定位、布局和格式化等用途。盒子与元素并不是一一对应的，有时多个元素会合并生成一个盒子，有时一个元素会生成多个盒子（如匿名盒子）。
- **块级元素**：block-level element，元素的 `display` 为 `block`、`list-item`、`table` 时，该元素将成为块级元素。元素是否是块级元素仅是元素本身的属性，并不直接用于格式化上下文的创建或布局。
- **块级盒子**：block-level box，由块级元素生成。一个块级元素至少会生成一个块级盒子，但也有可能生成多个（例如列表项元素）。
- **块盒子**：block box，如果一个块级盒子同时也是一个块容器盒子（见下），则称其为块盒子。除具名块盒子之外，还有一类块盒子是匿名的，称为匿名块盒子（Anonymous block box），匿名盒子无法被CSS选择符选中。
- **块容器盒子**：block container box或block containing box，块容器盒子侧重于当前盒子作为“容器”的这一角色，它不参与当前块的布局和定位，它所描述的仅仅是当前盒子与其后代之间的关系。换句话说，块容器盒子主要用于确定其子元素的定位、布局等。



### 盒子的生成

​	用于从文档元素生成盒子，不同盒子类型对应不同格式化方法，而盒子类型取决于元素的display属性。



#### 块级元素和块盒子

​	块级元素：元素display属性值为block，list-item和table时其为块级元素。块级元素被格式化为一个块。

​	块级元素生成盒子：每个块级元素会生成至少一个主块级盒子（principal block-level box），主块级盒子包含其后代元素生成的盒子和内容，同时主块级盒子会参与定位方案。（每个块级盒子还会参与块格式化上下文的创建）

​	块级盒子和块容器盒子：块级盒子描述了元素与其父元素，兄弟元素间的行为；而块容器盒子则描述元素与其子元素间行为。如果一个盒子既是块级盒子又是块容器盒子，则这个盒子称为块盒子（block box）。

##### 匿名块盒子

​	主要生成场景：在一个块元素中，包含另一个块元素，则内部块元素相邻的行内元素（或文本）会被转换为一个匿名块盒子。



#### 行内级元素和行内盒子

​	行内级元素： display属性值为inline，inline-box，inline-table。行内级元素不会被格式化为块。

​	行内级元素生成行内级盒子：行内级元素会生成行内级盒子，通过替换行内级元素或 `display` 值为 `inline-block` 或 `inline-table` 的元素创建的盒子不会像行内盒子一样可以被拆分为多个盒子。

##### 匿名行内盒子





